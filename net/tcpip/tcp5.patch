From owner-linux-activists@joker.cs.hut.fi Wed Aug  5 19:54:00 1992
Received: from funet.fi by lazy.qt.IPA.FhG.de with SMTP
	(5.61+/IDA-1.2.8/gandalf.2) id AA03798; Wed, 5 Aug 92 19:53:55 +0200
Received: from santra.hut.fi by funet.fi with SMTP (PP) id <12734-0@funet.fi>;
          Wed, 5 Aug 1992 20:44:54 +0300
Received: from joker.cs.hut.fi by santra.hut.fi (5.65c/8.0/TeKoLa) id AA23193;
          Wed, 5 Aug 1992 20:44:44 +0300
Received: by joker.cs.hut.fi (5.65b/6.8/S-TeKoLa) id AA23011;
          Wed, 5 Aug 92 20:44:27 +0300
Received: from sunlight.Stanford.EDU by joker.cs.hut.fi (5.65b/6.8/S-TeKoLa) 
          id AA23002; Wed, 5 Aug 92 20:43:45 +0300
Received: from elaine29.Stanford.EDU by sunlight.Stanford.EDU (4.1/AIR-1.0) 
          id AA23764; Wed, 5 Aug 92 10:43:45 PDT
From: bir7@leland.stanford.edu
Message-Id: <9208051743.AA23764@sunlight.Stanford.EDU>
Subject: Re: No Problem with tcpip diffs - alpha 5
Sender: owner-linux-activists@niksula.hut.fi
To: linux-activists@niksula.hut.fi
X-Note1: Remember to put 'X-Mn-Key: normal' to your mail body or header
Date: Wed, 5 Aug 92 10:43:45 PDT
Cc: linux-activists@joker.cs.hut.fi (Linux Activists),
        torvalds@kruuna.helsinki.fi (Linus Torvalds)
In-Reply-To: <9208051731.AA11359@sparta.com>; from "Robert T. Harris" at Aug 5, 92 1:31 pm
X-Mailer: ELM [version 2.3 PL11]

X-Mn-Key: NET

> When you are wrong - you are wrong - I was wrong - sorry!
> 
> I posted a message describing problems with the tcpip alpha 5 release diffs,
> my problem turned out to be trying to patch using the alpha 4 release diffs.  I
> left the old alpha release stuff in /usr/src/inet and thought that it had come 
> from alpha 5 - I wondered why I had a duplicate set of diffs at /usr/src!
> 

	Actually I think there may be problems with the diffs (Coming from
me you should expect that.)  They may have part of the profiling code in
them.  It seems that they are against a stock .97 kernel without the
profiling code, but the "new" kernel had the profiling code in.  If 
something strange happens, it might be do to that.  Now on to the bugs.

	First You will only be able to connect via the loopback interface
for 2 reasons.

	1) in line 107 of sock.h in the definition of struct sock:
		unsigned long retransmits should be long retransmits
	(connect sets it to negative to give more time to make the
	connection.)

	2) ip.c: ip_compute_csum
		unsigned short sum = 0;
should be
		unsigned long sum = 0;	

	 (around line 604)
		shrl $16, %%eax
		adcw %%ax, %%bx
		adcw $0, %%bx
	should be 
		shrl $16, %%eax
		addw %%ax, %%bx  <- changed the 'c' to a 'd'
		adcw $0, %%bx


	And (this one shouldn't matter.)
	(around line 622)
		lodsb
		movb $0,%%al
	should be
		lodsb
		movb $0, %%ah  <-- change the 'l' to a 'h'

With this I can connect using other than the loopback interface.
(It's what I get for rushing and only testing it with itself when
I've made some major changes.)

I'm sorry for the inconvenience.

Ross Biro bir7@leland.stanford.edu 
Member League for Programming Freedom (LPF)
mail league@prep.ai.mit.edu for information

